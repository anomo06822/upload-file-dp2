# 數據篩選與分組功能說明

## 新增功能概覽

DataPreview 組件已增強以下功能：

### 1. 動態字段分析
- 自動從數據中提取所有字段
- 識別字段類型（string, number, boolean, date, array, object）
- 統計每個字段的唯一值數量
- 計算數字類型字段的最小值和最大值

### 2. 高級數據篩選

#### 篩選面板
- 點擊「篩選」按鈕開啟/關閉篩選面板
- 篩選面板顯示所有可用字段及其類型信息
- 已套用篩選的字段會以高亮顯示

#### 不同類型的篩選控件

**字串類型欄位 (string, date):**
- 提供搜索框進行模糊匹配
- 不區分大小寫
- 即時篩選

**數字類型欄位 (number):**
- 提供最小值和最大值範圍篩選
- 顯示字段的實際數值範圍
- 可單獨設置最小值或最大值

**布林類型欄位 (boolean):**
- 下拉選擇框
- 選項：全部 / 是 (true) / 否 (false)

#### 篩選管理
- 顯示當前篩選條件的徽章
- 快速移除單一篩選
- 一鍵清除所有篩選
- 實時顯示篩選後的記錄數量

### 3. 增強的分組功能

- 基於任何動態提取的字段進行分組
- 顯示每組的記錄數量
- 分組會自動應用當前的篩選條件
- 可展開/收起各個分組

### 4. 改進的分頁系統

- 分頁基於篩選後的數據
- 顯示當前篩選狀態
- 顯示篩選前後的數據量對比

## 使用示例

### 示例數據

使用提供的測試數據 `sample-data-employees.json`：

```json
[
  {
    "id": 1,
    "name": "張三",
    "age": 25,
    "salary": 50000,
    "department": "技術部",
    "active": true,
    "city": "台北",
    "joinDate": "2023-01-15"
  },
  ...
]
```

### 常見使用場景

#### 場景 1: 篩選特定年齡範圍的員工
1. 點擊「篩選」按鈕開啟篩選面板
2. 找到 `age` 字段
3. 輸入最小值 `25`，最大值 `30`
4. 立即看到符合條件的記錄

#### 場景 2: 查找技術部的活躍員工
1. 開啟篩選面板
2. 在 `department` 字段輸入「技術部」
3. 在 `active` 字段選擇「是 (true)」
4. 查看篩選結果

#### 場景 3: 按城市分組查看員工
1. 設置所需的篩選條件（可選）
2. 在「分組依據」下拉選單選擇 `city`
3. 查看每個城市的員工數量
4. 點擊展開/收起各城市的詳細數據

#### 場景 4: 查找高薪員工
1. 開啟篩選面板
2. 在 `salary` 字段設置最小值 `60000`
3. 查看符合條件的員工
4. 可進一步按 `department` 分組查看

## 技術實現細節

### 字段分析函數
```typescript
analyzeFields(flattenedData: Record<string, any>[]): Map<string, FieldInfo>
```
- 分析所有字段的類型和統計信息
- 返回包含字段元數據的 Map

### 篩選應用函數
```typescript
applyFilters(
  data: Record<string, any>[],
  filters: FilterMap,
  fieldsInfo: Map<string, FieldInfo>
): Record<string, any>[]
```
- 根據篩選條件過濾數據
- 支持多字段同時篩選（AND 邏輯）

### 篩選類型定義
```typescript
interface FilterCondition {
  field: string;
  type: 'text' | 'number' | 'boolean' | 'select';
  value: any;
}
```

## UI/UX 特性

1. **響應式設計**: 篩選面板在不同螢幕尺寸下自動調整佈局
2. **即時反饋**: 篩選條件變更後立即更新結果
3. **視覺提示**:
   - 活躍篩選以徽章顯示
   - 已篩選的字段以高亮邊框標示
   - 顯示篩選前後的數據量對比
4. **持久化**: 字段顯示/隱藏設置保存在 localStorage

## 性能優化

- 使用 `useMemo` 緩存計算結果
- 篩選邏輯優化，避免不必要的重新計算
- 分頁處理大量數據

## 未來增強建議

1. **多級分組**: 支持先按 department，再按 city 的多級分組
2. **聚合統計**: 在分組時顯示總和、平均值、最大值、最小值
3. **篩選條件保存**: 允許保存常用的篩選組合
4. **導出功能**: 導出篩選後的數據
5. **高級篩選**: 支持 OR 邏輯、正則表達式等

## 測試建議

1. 測試不同類型的字段篩選
2. 測試多個篩選條件的組合
3. 測試分組與篩選的結合使用
4. 測試大量數據的性能表現
5. 測試邊界情況（空值、null、undefined）
